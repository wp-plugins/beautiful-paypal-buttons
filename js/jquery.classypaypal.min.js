/*!
 * jQuery ClassyPaypal
 * www.class.pm
 *
 * Written by Marius Stanciu - Sergiu <marius@class.pm>
 * Licensed under the MIT license www.class.pm/LICENSE-MIT
 * Version 1.0.0
 *
 */(function(c,f){function e(b,a,d){this.button=c(b);this.options=a;this.fallback=d||{};this.paypal=this.getPaypalVariables("cmd,notify_url,bn,amount,discount_amount,discount_amount2,discount_rate,discount_rate2,discount_num,item_name,item_number,quantity,shipping,shipping2,tax,tax_rate,undefined_quantity,weight,weight_unit,on*,os*,option_index,option_select*,option_amount*,business,currency_code,a*,p*,t*,src,srt,sra,no_note,custom,invoice,modify,usr_manage,page_style,image_url,cpp_cart_border_color,cpp_header_image,cpp_headerback_color,cpp_headerborder_color,cpp_logo_image,cpp_payflow_color,lc,cn,no_shipping,return,rm,cbt,cancel_return,address1,address2,city,country,email,first_name,last_name,charset,night_phone_a,night_phone_b,night_phone_c,state,zip"); this.checkout=null;this.init()}e.prototype.init=function(){this.button.addClass("ClassyPaypal-type-"+this.options.type+" ClassyPaypal-style-"+this.options.style);window.setTimeout(c.proxy(function(){this.button.addClass("ClassyPaypal-transit")},this),30);this.options.innerHTML&&this.button.html(this.options.innerHTML);this.options.tooltip&&this.tooltip();this.button.on("click touchend",c.proxy(function(a){a.preventDefault();if(!this.button.hasClass("ClassyPaypal-button-disabled")){this.checkout=this.getOptions(); if("function"===typeof this.options.beforeSubmit)if(a=this.options.beforeSubmit.call(this.button.get(0),this.checkout),"object"===typeof a)this.checkout=a;else return;this.submit()}},this));var b=this;this.api={enable:function(){b.button.removeClass("ClassyPaypal-button-disabled");return this},disable:function(){b.button.addClass("ClassyPaypal-button-disabled");return this},setVariable:function(a,d){0!==a.indexOf("data-")&&(a="data-"+a.toLowerCase());b.button.attr(a,d);return this}};this.button.data("ClassyPaypal-api", this.api)};e.prototype.getPaypalVariables=function(b){b=b.split(",");for(var a=0;a<b.length;a++){var d=b[a];if("*"===d.charAt(d.length-1))for(var d=d.slice(0,-1),c=0;10>c;c++)b.splice(a,!c&1,d+c)}return b};e.prototype.getOptions=function(){var b=this.fallback,a=this.button.data("json");"object"===typeof a?c.extend(b,a):"string"===typeof a&&window.console&&console.log('Error: Invalid JSON string in "data-json" attribute');for(a=0;a<this.paypal.length;a++){var d=this.paypal[a],e=this.button.attr("data-"+ d);e!==f&&""!==e&&(b[d]=e)}switch(this.options.type){case "buynow":b.cmd="_xclick";b.bn="PayNowPlugin_BuyNow_WPS_US";break;case "subscribe":b.cmd="_xclick-subscriptions";b.bn="PayNowPlugin_Subscribe_WPS_US";break;case "donate":b.cmd="_donations";b.bn="PayNowPlugin_Donate_WPS_US";break;default:b.cmd=""}return b};e.prototype.submit=function(){if(this.checkout.cmd&&this.checkout.business){this.form=c("<form/>");this.form.attr({action:"https://www.paypal.com/cgi-bin/webscr",method:"POST",target:this.options.checkoutTarget}).hide(); for(var b in this.checkout)if(this.checkout.hasOwnProperty(b)){var a=c("<input/>");a.attr({type:"hidden",name:b,value:this.checkout[b]});this.form.append(a)}c(document.body).append(this.form);this.options.delaySubmit?(this.button.addClass("ClassyPaypal-submit"),window.setTimeout(c.proxy(function(){this.form.submit().remove();this.button.removeClass("ClassyPaypal-submit")},this),this.options.delaySubmit)):this.form.submit().remove()}};e.prototype.tooltip=function(){var b=this.options.tooltipTime,a= c("body").children(".ClassyPaypal-tooltip");0===a.length&&(a=c('<div class="ClassyPaypal-tooltip"></div>').appendTo("body"));this.button.mouseenter(c.proxy(function(){var d=this.button.outerWidth(),e=this.button.outerHeight(),f=this.button.offset().top-c(window).scrollTop(),g=this.button.offset().left-c(window).scrollLeft(),d=(a.text(this.options.tooltip).outerWidth()-d)/2;a.css({top:f+e+parseFloat(this.options.tooltipOffset),left:g-d}).stop(!0).delay(this.options.tooltipDelay).fadeIn(b);this.options.tooltipHide&& a.data("timer",window.setTimeout(function(){a.stop(!0).fadeOut(b)},this.options.tooltipHide))},this));this.button.mouseleave(function(){a.stop(!0).fadeOut(b);window.clearTimeout(a.data("timer"))})};c.fn.ClassyPaypal=function(b,a){var d=c.extend({type:"buynow",style:"default",innerHTML:"",checkoutTarget:"_self",delaySubmit:0,tooltip:"",tooltipHide:3E3,tooltipTime:300,tooltipDelay:400,tooltipOffset:15,beforeSubmit:!1},b);return this.each(function(){new e(this,d,a)})}})(jQuery);